<!-- Mobile: top bar with menu button (visible only on small screens) -->
<div class="mobile-header" id="mobileHeader" aria-hidden="true">
    <button type="button" class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open menu" title="Open menu">☰</button>
    <a href="{{ url_for('index') }}" class="sidebar-brand">Highgate Avenue</a>
</div>
<!-- Overlay to close drawer when tapping outside (mobile only) -->
<div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>
<nav class="sidebar" id="sidebar" aria-label="Main navigation">
    <button type="button" class="sidebar-close" id="sidebarClose" aria-label="Close menu" title="Close menu">×</button>
    <div class="sidebar-header">
        <a href="{{ url_for('index') }}" class="sidebar-brand">Highgate Avenue</a>
        <button type="button" class="sidebar-toggle" id="sidebarToggle" aria-label="Collapse sidebar" title="Collapse sidebar">‹</button>
    </div>
    <ul class="sidebar-nav">
        <li class="sidebar-parent" id="sidebar-highgate">
            <span class="sidebar-parent-label" role="button" tabindex="0" aria-expanded="false" aria-controls="sidebar-highgate-sub">Highgate Avenue</span>
            <ul class="sidebar-sub" id="sidebar-highgate-sub">
                <li><a href="{{ url_for('index') }}" class="{% if request.endpoint == 'index' and not section_filter %}active{% endif %}">All</a></li>
                {% if sections_order is defined and all_sections is defined %}
                    {% for sid in sections_order %}
                        {% if sid in all_sections %}
                        <li><a href="{{ url_for('design_section', section_id=sid) }}" class="{% if section_filter is defined and section_filter == sid %}active{% endif %}">{{ all_sections[sid].label }}</a></li>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% for sid, s in (all_sections or {}).items() %}
                        <li><a href="{{ url_for('design_section', section_id=sid) }}" class="{% if section_filter is defined and section_filter == sid %}active{% endif %}">{{ s.label }}</a></li>
                    {% endfor %}
                {% endif %}
                <li><a href="{{ url_for('photo_gallery') }}" class="{% if section_filter is defined and section_filter == 'photo-gallery' %}active{% endif %}">Photo gallery</a></li>
                <li><a href="{{ url_for('categorize') }}" class="{% if request.endpoint == 'categorize' %}active{% endif %}">Categorize</a></li>
            </ul>
        </li>
        <li class="sidebar-parent" id="sidebar-muswell">
            <span class="sidebar-parent-label" role="button" tabindex="0" aria-expanded="false" aria-controls="sidebar-muswell-sub">Muswell Hill</span>
            <ul class="sidebar-sub" id="sidebar-muswell-sub">
                <li><a href="{{ url_for('muswell_hill_room', room_slug='front-room') }}" class="{% if request.endpoint == 'muswell_hill_room' and (muswell_room is defined and muswell_room == 'front-room') %}active{% endif %}">Front Room</a></li>
                <li><a href="{{ url_for('muswell_hill_room', room_slug='kitchen') }}" class="{% if request.endpoint == 'muswell_hill_room' and (muswell_room is defined and muswell_room == 'kitchen') %}active{% endif %}">Kitchen</a></li>
                <li><a href="{{ url_for('muswell_hill_room', room_slug='bathroom') }}" class="{% if request.endpoint == 'muswell_hill_room' and (muswell_room is defined and muswell_room == 'bathroom') %}active{% endif %}">Bathroom</a></li>
                <li><a href="{{ url_for('muswell_hill_room', room_slug='bedroom') }}" class="{% if request.endpoint == 'muswell_hill_room' and (muswell_room is defined and muswell_room == 'bedroom') %}active{% endif %}">Bedroom</a></li>
                <li><a href="{{ url_for('muswell_hill_room', room_slug='nursery') }}" class="{% if request.endpoint == 'muswell_hill_room' and (muswell_room is defined and muswell_room == 'nursery') %}active{% endif %}">Nursery</a></li>
                <li><a href="{{ url_for('muswell_hill_products') }}" class="{% if request.endpoint == 'muswell_hill_products' %}active{% endif %}">Products</a></li>
                <li><a href="{{ url_for('muswell_hill_baby') }}" class="{% if request.endpoint == 'muswell_hill_baby' %}active{% endif %}">Baby</a></li>
            </ul>
        </li>
        <li>
            <a href="{{ url_for('jobs') }}" class="{% if request.endpoint == 'jobs' %}active{% endif %}">Jobs</a>
        </li>
        <li>
            <a href="{{ url_for('work') }}" class="{% if request.endpoint == 'work' %}active{% endif %}">Work</a>
        </li>
    </ul>
</nav>
<button type="button" class="sidebar-open" id="sidebarOpen" aria-label="Open sidebar" title="Open sidebar" style="display: none;">›</button>
<script>
(function() {
    var layout = document.querySelector('.app-layout');
    var sidebar = document.getElementById('sidebar');
    var toggle = document.getElementById('sidebarToggle');
    var openBtn = document.getElementById('sidebarOpen');
    var mobileMenuBtn = document.getElementById('mobileMenuBtn');
    var sidebarOverlay = document.getElementById('sidebarOverlay');
    var sidebarClose = document.getElementById('sidebarClose');
    if (!layout || !sidebar) return;

    function isCollapsed() { return layout.classList.contains('sidebar-collapsed'); }
    function setCollapsed(collapsed) {
        layout.classList.toggle('sidebar-collapsed', collapsed);
        if (toggle) { toggle.setAttribute('aria-label', collapsed ? 'Open sidebar' : 'Collapse sidebar'); toggle.title = collapsed ? 'Open sidebar' : 'Collapse sidebar'; toggle.textContent = collapsed ? '›' : '‹'; }
        if (openBtn) openBtn.style.display = collapsed ? 'block' : 'none';
        try { localStorage.setItem('sidebarCollapsed', collapsed ? '1' : '0'); } catch (e) {}
    }

    function closeMobileMenu() {
        layout.classList.remove('mobile-menu-open');
        document.body.style.overflow = '';
    }
    function openMobileMenu() {
        layout.classList.add('mobile-menu-open');
        document.body.style.overflow = 'hidden';
    }

    if (toggle) toggle.addEventListener('click', function() { setCollapsed(!isCollapsed()); });
    if (openBtn) openBtn.addEventListener('click', function() { setCollapsed(false); });
    try { if (localStorage.getItem('sidebarCollapsed') === '1') setCollapsed(true); } catch (e) {}

    if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', openMobileMenu);
    if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeMobileMenu);
    if (sidebarClose) sidebarClose.addEventListener('click', closeMobileMenu);

    sidebar.querySelectorAll('a').forEach(function(link) {
        link.addEventListener('click', function() { closeMobileMenu(); });
    });

    [].forEach.call(document.querySelectorAll('.sidebar-parent-label'), function(label) {
        label.addEventListener('click', function(e) {
            var parent = label.closest('.sidebar-parent');
            if (parent) {
                parent.classList.toggle('expanded');
                var expanded = parent.classList.contains('expanded');
                label.setAttribute('aria-expanded', expanded);
            }
        });
    });
})();
</script>
